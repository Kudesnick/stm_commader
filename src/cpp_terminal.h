/***************************************************************************************************
 *   Project:     
 *   Author:        Stulov Tikhon (kudesnick@inbox.ru)
 ***************************************************************************************************
 *   Distribution:  
 *
 ***************************************************************************************************
 *   MCU Family:    STM32F
 *   Compiler:      ARMCC
 ***************************************************************************************************
 *   File:          terminal.h
 *   Description:   
 *
 ***************************************************************************************************
 *   History:       06.05.2019 - file created
 *
 **************************************************************************************************/

#pragma once

/***************************************************************************************************
 *                                      INCLUDED FILES
 **************************************************************************************************/

#include <stdlib.h>

#include "cpp_font.h"
#include "courier_new.h"
#include "fnt8x8.h"
#include "fnt8x16.h"
#include "atari.h"
#include "zx.h"

#ifdef __cplusplus
    using namespace std;
#endif

/***************************************************************************************************
 *                                       DEFINITIONS
 **************************************************************************************************/

/***************************************************************************************************
 *                                      PUBLIC TYPES
 **************************************************************************************************/

typedef struct
{
    uint16_t x, y;
} crd_t;

class cpp_terminal : protected font::cpp_font
{
private:
    const crd_t win_crd_;
    const crd_t win_size_;
    char * const p_buf_;
    const uint16_t buf_size_;
    uint16_t buf_ptr_;
    uint16_t scroll_ptr_;
    crd_t cursor_;
    void rect_calc_of_str_(const uint8_t, ili9341::rect_t&);
    void rect_calc_of_col_(const uint8_t, ili9341::rect_t&);
//    add_to_buf_(const char * const, const uint16_t);

public:
    cpp_terminal(const uint16_t _x,
                 const uint16_t _y,
                 const uint8_t _height,
                 const uint8_t _width,
                 const font::font_t& _font,
                 char * const _buffer = NULL,
                 uint16_t _buf_size = 0
                 );
    void clear(void);
    void print(const char * const _str);
    void print_int(uint32_t);
    void set_brush(const font::brush_t &_brush);
    void set_cursor(const int16_t _x, const int16_t _y);
    void scroll(const int16_t _x, const int16_t _y, bool _cycle = false);
};

/***************************************************************************************************
 *                               PRIVATE FUNCTION PROTOTYPES
 **************************************************************************************************/

/***************************************************************************************************
 *                                       PRIVATE DATA
 **************************************************************************************************/

/***************************************************************************************************
 *                                       PUBLIC DATA
 **************************************************************************************************/

/***************************************************************************************************
 *                              PUBLIC FUNCTION PROTOTYPES
 **************************************************************************************************/

/***************************************************************************************************
 *                                      EXTERNAL DATA
 **************************************************************************************************/

/***************************************************************************************************
 *                              EXTERNAL FUNCTION PROTOTYPES
 **************************************************************************************************/

/***************************************************************************************************
 *                                    PRIVATE FUNCTIONS
 **************************************************************************************************/

/***************************************************************************************************
 *                                    PUBLIC FUNCTIONS
 **************************************************************************************************/

/***************************************************************************************************
 *                                       END OF FILE
 **************************************************************************************************/
