/***************************************************************************************************
 *   Project:     
 *   Author:        Stulov Tikhon (kudesnick@inbox.ru)
 ***************************************************************************************************
 *   Distribution:  
 *
 ***************************************************************************************************
 *   MCU Family:    STM32F
 *   Compiler:      ARMCC
 ***************************************************************************************************
 *   File:          bsp_sdcard.c
 *   Description:   
 *
 ***************************************************************************************************
 *   History:       02.06.2019 - file created
 *
 **************************************************************************************************/

/*
Nucleo-64 pinout

Card holder | STM (SPI_2)
SCK           PB13
MISO          PB14
MOSI          PB15
CS1           PB11
CS2           PB12
*/

/***************************************************************************************************
 *                                      INCLUDED FILES
 **************************************************************************************************/

#include "bsp_sdcard.h"
#include "bsp_gpio.h"

#include "GPIO_STM32F10x.h"
#include "Driver_SPI.h"

#include "..\keil\RTE\File_System\FS_Config_MC_0.h"
#include "..\keil\RTE\File_System\FS_Config_MC_1.h"

/***************************************************************************************************
 *                                       DEFINITIONS
 **************************************************************************************************/

#define PIN_CS20 PORTB_11
#define PIN_CS21 PORTB_12

/***************************************************************************************************
 *                                      PUBLIC TYPES
 **************************************************************************************************/

/***************************************************************************************************
 *                               PRIVATE FUNCTION PROTOTYPES
 **************************************************************************************************/

/***************************************************************************************************
 *                                       PRIVATE DATA
 **************************************************************************************************/

/***************************************************************************************************
 *                                       PUBLIC DATA
 **************************************************************************************************/

/***************************************************************************************************
 *                              PUBLIC FUNCTION PROTOTYPES
 **************************************************************************************************/

/***************************************************************************************************
 *                                      EXTERNAL DATA
 **************************************************************************************************/

/***************************************************************************************************
 *                              EXTERNAL FUNCTION PROTOTYPES
 **************************************************************************************************/

/***************************************************************************************************
 *                                    PRIVATE FUNCTIONS
 **************************************************************************************************/

/***************************************************************************************************
 *                                    PUBLIC FUNCTIONS
 **************************************************************************************************/

void bsp_sdcard_init(void)
{
    
}

//-- see. SPI_MultiSlave.h
void SPI_Control_SlaveSelect (uint32_t device, uint32_t ss_state)
{
    switch(device)
    {
        case MC0_SPI_DRIVER: GPIO_PinWrite(PIN_CS20, (ss_state == ARM_SPI_SS_INACTIVE)); break;
        case MC1_SPI_DRIVER: GPIO_PinWrite(PIN_CS21, (ss_state == ARM_SPI_SS_INACTIVE)); break;
        default: break;
    }
}

/***************************************************************************************************
 *                                       END OF FILE
 **************************************************************************************************/
